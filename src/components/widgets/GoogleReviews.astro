---
interface Props {
  id?: string;
}

const { id = 'reviews' } = Astro.props;

const reviews = [
  {
    name: 'María Elena Rodríguez',
    location: 'Mérida, Yucatán',
    rating: 5,
    date: '2 semanas atrás',
    review: 'Excelente servicio de capacitación. Los cursos de IA que tomamos en mi empresa fueron muy prácticos y aplicables. La Lic. Perla es muy profesional y conocedora del tema. ¡Totalmente recomendable!',
    avatar: 'ME',
    photo: 'https://randomuser.me/api/portraits/women/44.jpg'
  },
  {
    name: 'Carlos Hernández Pérez',
    location: 'Cancún, Quintana Roo',
    rating: 5,
    date: '1 mes atrás',
    review: 'Contraté sus servicios de asesoría laboral y quedé muy satisfecho. Me ayudaron a resolver un tema complejo de nóminas y cumplimiento legal. Son expertos en la materia y muy atentos.',
    avatar: 'CH',
    photo: 'https://randomuser.me/api/portraits/men/32.jpg'
  },
  {
    name: 'Ana Patricia Sánchez',
    location: 'Playa del Carmen, Q. Roo',
    rating: 5,
    date: '3 semanas atrás',
    review: 'La capacitación en recursos humanos fue justo lo que necesitaba para mi equipo. Los instructores son muy profesionales y el material es de primera calidad. Obtuvimos nuestras constancias DC-3 sin problemas.',
    avatar: 'AP',
    photo: 'https://randomuser.me/api/portraits/women/68.jpg'
  },
  {
    name: 'Roberto Méndez García',
    location: 'Mérida, Yucatán',
    rating: 5,
    date: '2 meses atrás',
    review: 'ASL nos ha apoyado durante años con la gestión de personal y capacitación. Son un socio confiable y siempre están actualizados en las nuevas tendencias como la inteligencia artificial. Muy recomendables.',
    avatar: 'RM',
    photo: 'https://randomuser.me/api/portraits/men/46.jpg'
  },
  {
    name: 'Guadalupe Flores Martínez',
    location: 'Cancún, Quintana Roo',
    rating: 5,
    date: '1 semana atrás',
    review: 'Tomé un curso de IA aplicada a mi trabajo y fue increíble. Ahora utilizo herramientas que me ahorran mucho tiempo. La inversión valió totalmente la pena. Gracias ASL por compartir su conocimiento.',
    avatar: 'GF',
    photo: 'https://randomuser.me/api/portraits/women/90.jpg'
  },
  {
    name: 'Jorge Luis Torres',
    location: 'Mérida, Yucatán',
    rating: 5,
    date: '3 meses atrás',
    review: 'Excelente empresa consultora. Nos ayudaron con la implementación de procesos de RRHH y el resultado superó nuestras expectativas. El equipo es muy profesional y siempre dispuesto a ayudar.',
    avatar: 'JT',
    photo: 'https://randomuser.me/api/portraits/men/22.jpg'
  }
];
---

<section id={id} class="relative py-16 sm:py-20 bg-white overflow-hidden">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="text-center mb-12">
      <div class="flex items-center justify-center space-x-3 mb-4">
        <img 
          src="https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_92x30dp.png" 
          alt="Google" 
          class="h-8"
        />
        <h2 class="text-4xl md:text-5xl font-bold text-gray-900">Reseñas</h2>
      </div>
      <div class="flex items-center justify-center space-x-2">
        <div class="flex">
          {[...Array(5)].map(() => (
            <svg class="w-6 h-6 text-yellow-400 fill-current" viewBox="0 0 24 24">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
          ))}
        </div>
        <span class="text-2xl font-semibold text-gray-900">5.0</span>
        <span class="text-gray-600">· Basado en {reviews.length} reseñas</span>
      </div>
    </div>

    <!-- Slider Container -->
    <div class="relative">
      <div class="reviews-slider overflow-hidden">
        <div class="reviews-track flex transition-transform duration-500 ease-out">
          {reviews.map((review) => (
            <div class="review-card flex-shrink-0 w-full md:w-1/2 lg:w-1/3 px-4">
              <div class="bg-white rounded-2xl shadow-lg hover:shadow-xl transition-shadow p-6 h-full border border-gray-100">
                <!-- Header -->
                <div class="flex items-start justify-between mb-4">
                  <div class="flex items-center space-x-3">
                    <img 
                      src={review.photo} 
                      alt={review.name}
                      class="w-12 h-12 rounded-full object-cover border-2 border-gray-200"
                    />
                    <div>
                      <h3 class="font-semibold text-gray-900">{review.name}</h3>
                      <p class="text-sm text-gray-500">{review.location}</p>
                    </div>
                  </div>
                  <svg class="w-6 h-6 text-gray-400" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                  </svg>
                </div>

                <!-- Rating -->
                <div class="flex items-center space-x-1 mb-3">
                  {[...Array(review.rating)].map(() => (
                    <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 24 24">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                  ))}
                  <span class="text-sm text-gray-500 ml-2">{review.date}</span>
                </div>

                <!-- Review Text -->
                <p class="text-gray-700 leading-relaxed">{review.review}</p>
              </div>
            </div>
          ))}
        </div>
      </div>

      <!-- Navigation Buttons -->
      <button
        class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 bg-white rounded-full p-3 shadow-lg hover:shadow-xl transition-all z-10 hover:bg-gray-50"
        id="prevBtn"
        aria-label="Anterior"
      >
        <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      </button>
      <button
        class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 bg-white rounded-full p-3 shadow-lg hover:shadow-xl transition-all z-10 hover:bg-gray-50"
        id="nextBtn"
        aria-label="Siguiente"
      >
        <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </button>
    </div>

    <!-- Dots Indicator -->
    <div class="flex justify-center space-x-2 mt-8" id="dotsContainer">
      <!-- Dots will be generated by JavaScript -->
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const track = document.querySelector('.reviews-track') as HTMLElement;
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const dotsContainer = document.getElementById('dotsContainer');
    
    if (!track || !prevBtn || !nextBtn || !dotsContainer) return;

    const cards = track.querySelectorAll('.review-card');
    let currentIndex = 0;
    let cardsPerView = 3;

    const updateCardsPerView = () => {
      if (window.innerWidth < 768) {
        cardsPerView = 1;
      } else if (window.innerWidth < 1024) {
        cardsPerView = 2;
      } else {
        cardsPerView = 3;
      }
    };

    const totalDots = Math.ceil(cards.length / cardsPerView);

    // Create dots
    const createDots = () => {
      dotsContainer.innerHTML = '';
      for (let i = 0; i < totalDots; i++) {
        const dot = document.createElement('button');
        dot.className = `w-3 h-3 rounded-full transition-all ${i === 0 ? 'bg-blue-600 w-8' : 'bg-gray-300'}`;
        dot.setAttribute('aria-label', `Ir a grupo ${i + 1}`);
        dot.addEventListener('click', () => goToSlide(i));
        dotsContainer.appendChild(dot);
      }
    };

    const updateDots = () => {
      const dots = dotsContainer.querySelectorAll('button');
      dots.forEach((dot, index) => {
        if (index === currentIndex) {
          dot.className = 'w-8 h-3 rounded-full bg-blue-600 transition-all';
        } else {
          dot.className = 'w-3 h-3 rounded-full bg-gray-300 transition-all';
        }
      });
    };

    const goToSlide = (index: number) => {
      currentIndex = index;
      const offset = -(currentIndex * 100);
      track.style.transform = `translateX(${offset}%)`;
      updateDots();
    };

    prevBtn.addEventListener('click', () => {
      currentIndex = currentIndex > 0 ? currentIndex - 1 : totalDots - 1;
      goToSlide(currentIndex);
    });

    nextBtn.addEventListener('click', () => {
      currentIndex = currentIndex < totalDots - 1 ? currentIndex + 1 : 0;
      goToSlide(currentIndex);
    });

    updateCardsPerView();
    createDots();

    window.addEventListener('resize', () => {
      const oldCardsPerView = cardsPerView;
      updateCardsPerView();
      if (oldCardsPerView !== cardsPerView) {
        currentIndex = 0;
        goToSlide(0);
        createDots();
      }
    });

    // Auto-play
    setInterval(() => {
      currentIndex = currentIndex < totalDots - 1 ? currentIndex + 1 : 0;
      goToSlide(currentIndex);
    }, 5000);
  });
</script>
